<!-- pages/admin/template/list.wxml -->
<view class="container">
  <!-- щб╢щГицУНф╜ЬцаП -->
  <view class="action-bar">
    <view class="search-box">
      <input type="text" class="search-input" placeholder="цРЬч┤вцибцЭ┐хРНчз░..." bindinput="onSearchInput"/>
      <button class="search-btn" bindtap="handleSearch">цРЬч┤в</button>
    </view>
    <view class="action-buttons">
      <button class="btn-batch-delete" bindtap="showBatchDeleteConfirm" wx:if="{{selectedTemplates.length > 0}}">цЙ╣щЗПхИащЩд({{selectedTemplates.length}})</button>
      <button class="btn-upload" bindtap="showUploadModal">ф╕Кф╝ацЦ░цибцЭ┐</button>
    </view>
  </view>

  <!-- цибцЭ┐хИЧшбишбица╝ -->
  <view class="table-container">
    <!-- шбихд┤ -->
    <view class="table-header">
      <view class="th th-checkbox">
        <checkbox checked="{{selectAll}}" bindtap="toggleSelectAll" />
      </view>
      <view class="th th-name">цибцЭ┐хРНчз░</view>
      <view class="th th-desc">цППш┐░</view>
      <view class="th th-date">ф╕Кф╝ацЧецЬЯ</view>
      <view class="th th-status">цПРф║дцГЕхЖ╡</view>
      <view class="th th-actions">цУНф╜Ь</view>
    </view>

    <!-- цЧацХ░цНоцПРчд║ -->
    <view class="no-data" wx:if="{{!templates.length}}">
      <text>цЪВцЧацибцЭ┐цХ░цНо</text>
    </view>

    <!-- шбица╝хЖЕхо╣ -->
    <block wx:else>
      <view class="table-row" wx:for="{{filteredTemplates}}" wx:key="id" bindtap="viewSubmissionDetails" data-id="{{item.id}}" data-name="{{item.name}}">
        <view class="td td-checkbox" catchtap="stopPropagation">
          <checkbox checked="{{selectedIds[item.id]}}" catchtap="toggleSelect" data-id="{{item.id}}" />
        </view>
        <view class="td td-name">{{item.name}}</view>
        <view class="td td-desc">{{item.description || 'цЧацППш┐░'}}</view>
        <view class="td td-date">{{item.upload_date}}</view>
        <view class="td td-status">
          <text class="status-text">{{item.submitted_count || 0}}/{{item.total_users || 0}}</text>
          <progress class="status-progress" percent="{{(item.submitted_count / item.total_users) * 100 || 0}}" stroke-width="4" color="#10b981" active />
        </view>
        <view class="td td-actions" catchtap="stopPropagation">
          <button class="btn btn-download" catchtap="downloadTemplate" data-id="{{item.id}}" data-name="{{item.name}}">ф╕Лш╜╜</button>
          <button class="btn btn-delete" catchtap="deleteTemplate" data-id="{{item.id}}" data-name="{{item.name}}">хИащЩд</button>
        </view>
      </view>
    </block>
  </view>

  <!-- хКаш╜╜цЫ┤хдЪцПРчд║ -->
  <view class="load-more" wx:if="{{templates.length > 0 && hasMoreData}}">
    <text wx:if="{{isLoading}}">цнгхЬихКаш╜╜...</text>
    <text wx:else bindtap="loadMoreData">хКаш╜╜цЫ┤хдЪ</text>
  </view>

  <!-- ф╕Кф╝ацибцЭ┐цибцАБцбЖ - ф╝ШхМЦчЙИ -->
  <view class="modal" wx:if="{{showUpload}}" catchtouchmove="preventTouchMove">
    <view class="modal-mask" bindtap="hideUploadModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ф╕Кф╝ацЦ░цибцЭ┐</text>
        <text class="close" bindtap="hideUploadModal">├Ч</text>
      </view>
      <form bindsubmit="handleUpload">
        <view class="form-body">
          <view class="form-item">
            <text class="label required">цибцЭ┐хРНчз░</text>
            <input class="input" name="name" placeholder="шп╖ш╛УхЕецибцЭ┐хРНчз░" />
          </view>
          
          <view class="form-item">
            <text class="label">цибцЭ┐цППш┐░</text>
            <textarea class="textarea" name="description" placeholder="шп╖чоАшжБцППш┐░цндцибцЭ┐чЪДчФищАФцИЦц│ицДПф║Лщб╣" />
          </view>
          
          <view class="form-item">
            <text class="label required">щАЙцЛйцЦЗф╗╢</text>
            <view class="file-upload-area">
              <view class="file-box {{chosenFile ? 'has-file' : ''}}">
                <view class="upload-icon" wx:if="{{!chosenFile}}">
                  <view class="icon-plus">+</view>
                  <view class="upload-text">чВ╣хЗ╗щАЙцЛйцЦЗф╗╢</view>
                </view>
                <view class="file-info" wx:if="{{chosenFile}}">
                  <view class="file-icon">ЁЯУД</view>
                  <view class="file-details">
                    <text class="file-name">{{chosenFile.name}}</text>
                  </view>
                  <view class="file-action">
                    <text class="file-change" catchtap="chooseFile">цЫ┤цФ╣</text>
                  </view>
                </view>
              </view>
              <button class="btn-choose" bindtap="chooseFile" wx:if="{{!chosenFile}}">щАЙцЛйцЦЗф╗╢</button>
            </view>
          </view>
          
          <view class="upload-progress-container" wx:if="{{uploadProgress > 0}}">
            <text class="progress-text">ф╕Кф╝аф╕н {{uploadProgress}}%</text>
            <progress class="upload-progress" percent="{{uploadProgress}}" stroke-width="4" activeColor="#10b981" backgroundColor="#e5e7eb" active active-mode="forwards" />
          </view>
        </view>

        <view class="form-actions">
          <button class="btn-cancel" bindtap="hideUploadModal">хПЦц╢И</button>
          <button class="btn-submit" form-type="submit" disabled="{{!chosenFile}}">
            {{uploadProgress > 0 ? 'ф╕Кф╝аф╕н...' : 'ф╕Кф╝ацибцЭ┐'}}
          </button>
        </view>
      </form>
    </view>
  </view>

  <!-- цЙ╣щЗПхИащЩдчбошодцибцАБцбЖ -->
  <view class="modal" wx:if="{{showBatchDelete}}" catchtouchmove="preventTouchMove">
    <view class="modal-mask" bindtap="hideBatchDeleteModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">чбошодцЙ╣щЗПхИащЩд</text>
        <text class="close" bindtap="hideBatchDeleteModal">├Ч</text>
      </view>
      <view class="modal-body">
        <view class="warning-message">
          <view class="warning-icon">тЪая╕П</view>
          <text>цВихН│х░ЖхИащЩд {{selectedTemplates.length}} ф╕кцибцЭ┐я╝МцндцУНф╜Ьф╕НхПпцБвхдНя╝Б</text>
        </view>
        <view class="template-list">
          <view class="template-item" wx:for="{{selectedTemplates}}" wx:key="id">
            <text>тАв {{item.name}}</text>
          </view>
        </view>
        <view class="warning-text">цЙАцЬЙхЕ│шБФчЪДцПРф║дцХ░цНоф╣Ях░ЖшвлхИащЩдуАВ</view>
      </view>
      <view class="form-actions">
        <button class="btn-cancel" bindtap="hideBatchDeleteModal">хПЦц╢И</button>
        <button class="btn-delete-confirm" bindtap="executeBatchDelete" disabled="{{isDeleting}}">
          {{isDeleting ? 'хИащЩдф╕н...' : 'чбошодхИащЩд'}}
        </button>
      </view>
    </view>
  </view>
</view>