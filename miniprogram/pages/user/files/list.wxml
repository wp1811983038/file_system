<view class="container">
  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-box">
    <input type="text" 
           class="search-input" 
           placeholder="æœç´¢æ–‡ä»¶å..." 
           bindinput="onSearch"/>
  </view>

  <!-- æ–‡ä»¶å¡ç‰‡åˆ—è¡¨ -->
  <view class="file-list">
    <block wx:if="{{!templates.length}}">
      <view class="no-data">æš‚æ— æ•°æ®</view>
    </block>
    <block wx:else>
      <view class="file-card" wx:for="{{templates}}" wx:key="id">
        <view class="file-header">
          <view class="file-name">{{item.name || 'æœªå‘½å'}}</view>
          <view class="file-status">
            <block wx:if="{{!item.status}}">
              <text class="status-badge status-pending">æœªæäº¤</text>
            </block>
            <block wx:else>
              <text class="status-badge {{item.submission_status === 'approved' ? 'status-approved' : (item.submission_status === 'rejected' ? 'status-rejected' : 'status-submitted')}}"
                    bindtap="showApprovalDetail" 
                    data-id="{{item.submission_id}}"
                    data-status="{{item.submission_status}}">
                {{item.submission_status === 'approved' ? 'å·²æ‰¹å‡†' : (item.submission_status === 'rejected' ? 'å·²æ‹’ç»' : 'å¾…å®¡æ‰¹')}}
              </text>
            </block>
          </view>
        </view>
        
        <view class="file-description clickable" bindtap="showDescription" data-description="{{item.description || 'æ— '}}">
          <text class="description-label">æè¿°ï¼š</text>
          <text class="description-text">{{item.description || 'æ— '}}</text>
        </view>
        
        <view class="file-actions">
          <button class="btn download-btn" bindtap="downloadTemplate" 
                  data-id="{{item.id}}" 
                  data-name="{{item.name}}">
            ä¸‹è½½
          </button>
          
          <block wx:if="{{item.status}}">
            <button class="btn primary-btn" 
                    bindtap="openActionSheet" 
                    data-template-id="{{item.id}}">
              æ“ä½œ
            </button>
          </block>
          <block wx:else>
            <button class="btn primary-btn" 
                    bindtap="openUploadModal" 
                    data-template-id="{{item.id}}" 
                    data-is-resubmit="{{false}}">
              æäº¤
            </button>
          </block>
        </view>
      </view>
    </block>
  </view>
</view>

<!-- ä¸Šä¼ æ–‡ä»¶å¼¹çª— -->
<view class="modal" wx:if="{{showUploadModal}}" catchtouchmove="preventTouchMove">
  <view class="modal-content">
    <view class="modal-title">{{isResubmit ? 'é‡æ–°æäº¤æ–‡ä»¶' : 'æäº¤æ–‡ä»¶'}}</view>
    <form bindsubmit="submitFile">
      <view class="form-group">
        <button class="btn primary-btn" bindtap="chooseFile">é€‰æ‹©æ–‡ä»¶</button>
        <view class="selected-file" wx:if="{{selectedFile}}">
          å·²é€‰æ‹©ï¼š{{selectedFile.name}}
        </view>
      </view>
      <view class="modal-btns">
        <button class="btn cancel-btn" bindtap="closeUploadModal">å–æ¶ˆ</button>
        <button class="btn primary-btn" form-type="submit" disabled="{{!selectedFile}}">ç¡®å®š</button>
      </view>
    </form>
  </view>
</view>

<!-- æè¿°å†…å®¹æŸ¥çœ‹å¼¹çª— -->
<view class="modal description-modal" wx:if="{{showDescriptionModal}}" catchtouchmove="preventTouchMove" bindtap="closeDescriptionModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-title">è¯¦ç»†æè¿°</view>
    <view class="description-content">{{currentDescription}}</view>
    <view class="modal-btns">
      <button class="btn primary-btn" bindtap="closeDescriptionModal">å…³é—­</button>
    </view>
  </view>
</view>

<!-- å®¡æ‰¹è¯¦æƒ…æ¨¡æ€æ¡† -->
<view class="modal approval-modal" wx:if="{{showApprovalModal}}" catchtouchmove="preventTouchMove" bindtap="hideApprovalModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-title">å®¡æ‰¹è¯¦æƒ…</view>
    <view class="approval-status">
      <view class="status-label">çŠ¶æ€ï¼š</view>
      <view class="status-value {{approvalDetail.status === 'approved' ? 'text-approved' : (approvalDetail.status === 'rejected' ? 'text-rejected' : 'text-pending')}}">
        {{approvalDetail.status === 'approved' ? 'å·²æ‰¹å‡†' : (approvalDetail.status === 'rejected' ? 'å·²æ‹’ç»' : 'å¾…å®¡æ‰¹')}}
      </view>
    </view>
    <view class="approval-date" wx:if="{{approvalDetail.approval_date}}">
      <view class="date-label">å®¡æ‰¹æ—¶é—´ï¼š</view>
      <view class="date-value">{{approvalDetail.approval_date}}</view>
    </view>
    <view class="approval-comments">
      <view class="comments-label">å®¡æ‰¹æ„è§ï¼š</view>
      <view class="comments-value">{{approvalDetail.comments || 'æ— å®¡æ‰¹æ„è§'}}</view>
    </view>
    <view class="modal-btns">
      <button class="btn primary-btn" bindtap="hideApprovalModal">å…³é—­</button>
    </view>
  </view>
</view>

<!-- é€šçŸ¥å¼¹çª— -->
<view class="notification-modal" wx:if="{{showNotification}}" catchtouchmove="preventTouchMove">
  <view class="modal-mask" bindtap="closeNotification"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">
        <text class="modal-icon">ğŸ“¢</text>
        ç³»ç»Ÿé€šçŸ¥
      </text>
      <view class="modal-close" bindtap="closeNotification">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="notification-content">{{notificationContent}}</view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-primary" bindtap="closeNotification">æˆ‘çŸ¥é“äº†</button>
    </view>
  </view>
</view>